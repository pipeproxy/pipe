'@Kind': Once@config
Components:
- '@Kind': Service@multi
  '@Name': server
  Multi:
  - '@Kind': Service@stream
    Handler:
      '@Kind': stream.Handler@http
      Handler:
        '@Kind': http.Handler@log
        Handler:
          '@Ref': redirect
        Output:
          '@Kind': Output@file
          Path: /dev/stderr
      TLS: null
    Listener:
      '@Kind': stream.ListenConfig@network
      Address: :80
      Network: tcp
  - '@Kind': Service@stream
    Handler:
      '@Kind': stream.Handler@http
      Handler:
        '@Kind': http.Handler@log
        Handler:
          '@Ref': page
        Output:
          '@Kind': Output@file
          Path: /dev/stderr
      TLS:
        '@Kind': TLS@self_signed
    Listener:
      '@Kind': stream.ListenConfig@network
      Address: :443
      Network: tcp
- '@Kind': http.Handler@redirect
  '@Name': redirect
  Code: 302
  Location: '{{.Scheme}}s://{{.Host}}{{.RequestURI}}'
- '@Kind': http.Handler@direct
  '@Name': page
  Body:
    '@Kind': Input@inline
    Data: <html><body>This is Pipe page {{.Scheme}}://{{.Host}}{{.RequestURI}}</body></html>
  Code: 200
Init: null
Pipe:
  '@Kind': Service@multi
  Multi:
  - '@Ref': server
