'@Kind': Once@config
Components:
- '@Kind': Service@stream
  '@Name': server
  Handler:
    '@Kind': stream.Handler@http
    Handler:
      '@Kind': http.Handler@log
      Handler:
        '@Ref': balance
      Output:
        '@Kind': Output@file
        Path: /dev/stderr
    TLS: null
  Listener:
    '@Kind': stream.ListenConfig@network
    Address: :80
    Network: tcp
- '@Kind': http.Handler@poller
  '@Name': balance
  Handlers:
  - '@Kind': http.Handler@forward
    RoundTripper: null
    URL: http://127.0.0.1:8001
  - '@Kind': http.Handler@forward
    RoundTripper: null
    URL: http://127.0.0.1:8002
  Poller: round_robin
- '@Kind': Service@stream
  '@Name': host1
  Handler:
    '@Kind': stream.Handler@http
    Handler:
      '@Kind': http.Handler@log
      Handler:
        '@Ref': page1
      Output:
        '@Kind': Output@file
        Path: /dev/stderr
    TLS: null
  Listener:
    '@Kind': stream.ListenConfig@network
    Address: :8001
    Network: tcp
- '@Kind': http.Handler@direct
  '@Name': page1
  Body:
    '@Kind': Input@inline
    Data: <html><body>This is Pipe page1 {{.Scheme}}://{{.Host}}{{.RequestURI}}</body></html>
  Code: 200
- '@Kind': Service@stream
  '@Name': host2
  Handler:
    '@Kind': stream.Handler@http
    Handler:
      '@Kind': http.Handler@log
      Handler:
        '@Ref': page2
      Output:
        '@Kind': Output@file
        Path: /dev/stderr
    TLS: null
  Listener:
    '@Kind': stream.ListenConfig@network
    Address: :8002
    Network: tcp
- '@Kind': http.Handler@direct
  '@Name': page2
  Body:
    '@Kind': Input@inline
    Data: <html><body>This is Pipe page2 {{.Scheme}}://{{.Host}}{{.RequestURI}}</body></html>
  Code: 200
Init: null
Pipe:
  '@Kind': Service@multi
  Multi:
  - '@Ref': host1
  - '@Ref': host2
  - '@Ref': gateway
