Pipe:
  '@Kind': multi
  Multi:
    - '@Ref': host1
    - '@Ref': host2
    - '@Ref': gateway

Components:
  Services:
    - '@Kind': server
      '@Name': gateway
      Listener:
        '@Kind': network
        Network: tcp
        Address: :80
      Handler:
        '@Kind': http
        Handler:
          '@Ref': balance

    - '@Kind': server
      '@Name': host1
      Listener:
        '@Kind': network
        Network: tcp
        Address: :8001
      Handler:
        '@Kind': http
        Handler:
          '@Ref': page1

    - '@Kind': server
      '@Name': host2
      Listener:
        '@Kind': network
        Network: tcp
        Address: :8002
      Handler:
        '@Kind': http
        Handler:
          '@Ref': page2

  HttpHandlers:
    - '@Kind': poller
      '@Name': balance
      Poller: round_robin
      Handlers:
        - '@Kind': forward
          Pass: http://127.0.0.1:8001
        - '@Kind': forward
          Pass: http://127.0.0.1:8002

    - '@Kind': direct
      '@Name': page1
      Body: |
        <html><body>This is Pipe page1 {{.Scheme}}://{{.Host}}{{.RequestURI}}</body></html>

    - '@Kind': direct
      '@Name': page2
      Body: |
        <html><body>This is Pipe page2 {{.Scheme}}://{{.Host}}{{.RequestURI}}</body></html>
