Pipe:
  '@Kind': multi
  Multi:
    - '@Ref': http_server

Components:
  - '@Kind': github.com/wzshiming/pipe/service.Service@multi
    '@Name': http_server
    Multi:
      - '@Kind': server
        Listener:
          '@Kind': network
          Network: tcp
          Address: :80
        Handler:
          '@Kind': http
          Handler:
            '@Kind': h2c
            Handler:
              '@Ref': handle

      - '@Kind': server
        Listener:
          '@Kind': network
          Network: tcp
          Address: :443
        Handler:
          '@Kind': http
          TLS:
            '@Kind': self_signed
          Handler:
            '@Ref': handle

  - '@Kind': net/http.Handler@log
    '@Name': handle
    Output:
      '@Kind': io.WriteCloser@file
      Path: /dev/stderr
    Handler:
      '@Ref': page

  - '@Kind': net/http.Handler@mux
    '@Name': page
    Routes:
      - Path: /
        Handler:
          '@Kind': direct
          Body:
            '@Kind': inline
            Data: |
              <html>
              <body>
              This is Pipe {{.Scheme}}://{{.Host}}{{.RequestURI}}
              <pre>
              <a href="/expvar/">/expvar/</a>
              <a href="/pprof/">/pprof/</a>
              <a href="/config_dump/">/config_dump/</a>
              </pre>
              </body>
              </html>
      - Path: /expvar/
        Handler:
          '@Kind': expvar
      - Prefix: /pprof/
        Handler:
          '@Kind': pprof
      - Path: /config_dump/
        Handler:
          '@Kind': config_dump